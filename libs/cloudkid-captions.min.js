(function(){function t(t){var i=t.lastIndexOf("."),e=parseInt(t.substr(i+1),10),n=t.substr(0,i).split(":"),s=36e5*parseInt(n[0],10),r=6e3*parseInt(n[1],10),a=1e3*parseInt(n[2],10);return s+r+a+e}var i=cloudkid.Audio,e=function(t,i){this.isSlave=!!i,this.initialize(t)},n=e.prototype;n._captionDict=null,n._textField=null,n._completeCallback=null,n._lines=null,n._currentDuration=0,n._currentTime=0,n._currentLine=-1,n._lastActiveLine=-1,n._playing=!1;var s=null,r=!1;n.isSlave=!1,n.textIsProp=!0,n._isDestroyed=!1,n._boundUpdate=null,n._boundComplete=null,e.VERSION="1.0.0",e.init=function(t,i){s=new e(t,i)},Object.defineProperty(e,"instance",{get:function(){return s}}),n.initialize=function(t){if(this._lines=[],!(this.isSlave||i&&i.instance))throw"cloudkid.Audio must be loaded before captions are available";this.setDictionary(t),this._boundUpdate=this._updatePercent.bind(this),this._boundComplete=this._onSoundComplete.bind(this)},e.setMuteAll=function(t){r=t,s&&s._updateCaptions()},e.getMuteAll=function(){return r},n.setDictionary=function(i){if(i){this._captionDict=i;var e=/[0-9]+\:[0-9]{2}\:[0-9]{2}\.[0-9]{3}/;for(var n in i){var s=Array.isArray(i[n])?i[n]:i[n].lines;if(s)for(var r=0,a=s.length;a>r;++r){var l=s[r];"string"==typeof l.start&&(l.start=e.test(l.start)?t(l.start):parseInt(l.start,10)),"string"==typeof l.end&&(l.end=e.test(l.end)?t(l.end):parseInt(l.end,10))}else Debug.log("alias '"+n+"' has no lines!")}}},n.setTextField=function(t){this._textField&&(this.textIsProp?this._textField.text="":this._textField.setText("")),this._textField=t||null},n.hasCaption=function(t){return this._captionDict?!!this._captionDict[t]:!1},n._load=function(t){return this._isDestroyed?void 0:(this._reset(),t?(this._lines=t.lines,void 0):(this._lines=null,void 0))},n._reset=function(){this._currentLine=-1,this._lastActiveLine=-1},n.isPlaying=function(){return this._playing},n._calcCurrentDuration=function(){var t=this._lines;return t?t[t.length-1].end:0},Object.defineProperty(n,"currentDuration",{get:function(){return this._currentDuration}}),n.play=function(t,e){this._completeCallback=e,this._playing=!0,this._load(this._captionDict[t]),this.isSlave?this._currentDuration=this._calcCurrentDuration():(this._currentDuration=1e3*i.instance.getLength(t),i.instance.play(t,this._boundComplete,this._boundUpdate)),this.seek(0)},n.run=function(t){return this._completeCallback=null,this._load(this._captionDict[t]),this._currentDuration=this.isSlave?this._calcCurrentDuration():1e3*i.instance.getLength(t),this.seek(0),this._boundUpdate},n._onSoundComplete=function(){var t=this._completeCallback;this.stop(),t&&t()},n.stop=function(){!this.isSlave&&this._playing&&(i.instance.stop(),this._playing=!1),this._lines=null,this._completeCallback=null,this._reset(),this._updateCaptions()},n.seek=function(t){var i=this._currentTime=t,e=this._lines;if(!e)return this._updateCaptions(),void 0;if(e[0].start>i)return currentLine=this._lastActiveLine=-1,this._updateCaptions(),void 0;for(var n=e.length,s=0;n>s;s++){if(i>=e[s].start&&e[s].end>=i){this._currentLine=this._lastActiveLine=s,this._updateCaptions();break}i>e[s].end&&(this._lastActiveLine=s,this._currentLine=-1)}},n._updatePercent=function(t){this._isDestroyed||(this._currentTime=t*this._currentDuration,this._calcUpdate())},n.updateTime=function(t){this._isDestroyed||(this._currentTime+=t,this._calcUpdate())},n._calcUpdate=function(){var t=this._lines;if(t){var i=t.length,e=this._lastActiveLine+1,n=i-1,s=this._currentTime;s>=t[n].end?(this._currentLine=-1,this._updateCaptions()):n>=e&&s>=t[e].start&&t[e].end>=s?(this._currentLine=this._lastActiveLine=e,this._updateCaptions()):-1!=this._currentLine&&s>t[this._currentLine].end&&(this._lastActiveLine=this._currentLine,this._currentLine=-1,this._updateCaptions())}},n._updateCaptions=function(){if(this._textField){var t=-1==this._currentLine||r?"":this._lines[this._currentLine].content;this.textIsProp?this._textField.text=t:this._textField.setText(t)}},n.destroy=function(){this._isDestroyed||(this._isDestroyed=!0,s===this&&(s=null),this._captionDict=null,this._lines=null)},namespace("cloudkid").Captions=e})();