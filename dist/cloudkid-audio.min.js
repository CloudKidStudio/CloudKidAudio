!function(t,i,n){"use strict";var s=cloudkid.OS,e=cloudkid.SwishSprite,o=cloudkid.MediaLoader,u=function(t,i){this._onUpdate=this._onUpdate.bind(this),this._onComplete=this._onComplete.bind(this),this.initialize(t,i)},a=u.prototype,l=null,r=!1,c=null,d=null,p=null,h=null,_=!1,f=0,m=!1,A=0,y=0,k="AudioMute",C="SwishSprite",S=null,b=null,g=null;a.soundLoaded=!1,u.VERSION="2.0.0",u.init=function(t,i){return b||new u(t,i),b},Object.defineProperty(u,"instance",{get:function(){return b}}),a.initialize=function(t,i){b||(r=!1,b=this,"object"==typeof t?L(t,i):"string"==typeof t?o.instance.load(t,function(t){return t&&t.content?void L(t.content,i):void i(!1)}):i(!1))};var L=function(t,i){l=t;var s=!0;l&&l.resources===n&&(s=!1),l&&l.spritemap===n&&(s=!1),i(s)},O=function(t){if(!S)return!1;if(t!==n){if(!l||!l.spritemap)return!1;if(l.spritemap[t]===n)return!1}return!0};a.getAudioSprite=function(){return S},a.load=function(t){if(l){var i,u,a=o.instance.cacheManager,r=l.resources.length;for(i=0;r>i;i++)u=l.resources[i],l.resources[i]=a.prepare(u.url!==n?u.url:u,!0);S||(S=new e(l),S.manualUpdate=!0);var c=this;S.off(e.LOADED),S.on(e.LOADED,function(){S.off(e.LOADED).on(e.PROGRESS,c._onUpdate).on(e.COMPLETE,c._onComplete),c.soundLoaded=!0,t()}),s.instance.addUpdateCallback(C,S.update),S.load()}},a.prepare=function(t){O(t)&&S.prepare(t)},a.isPlaying=function(){return!_},a.pause=function(){!_&&S&&c&&(m?this._stopSilence():S.pause(),_=!0)},a.resume=function(){_&&S&&c&&(m?this._startSilence():S.resume(),_=!1)},a.play=function(t,i,n,s){return O(t)?(_||this.stop(),d=t,c=l.spritemap[t],p=i||null,h=s||null,_=!1,f=0,y=0,m?this._playSilence():this._playAudio(),g=new v,g._end=1e3*c.end,g._start=1e3*c.start,g.length=g._end-g._start,"function"==typeof n&&setTimeout(n,0),g):null},a._playSilence=function(){A=this.getLength(d),y=S.getPosition(),h&&h(f),this._startSilence()},a._startSilence=function(){s.instance.addUpdateCallback(k,this._updateSilence.bind(this))},a._stopSilence=function(){s.instance.removeUpdateCallback(k)},a._updateSilence=function(t){y+=t/1e3,f=y/A,A>y?h&&h(Math.min(1,Math.max(0,f))):this._onComplete()},a._playAudio=function(){h&&h(f);var t;y>0&&(t=S.getSound(d).start+y),S.play(d,t)},a._onUpdate=function(t){f=t,h&&h(f)},a._onComplete=function(){c&&(c.loop?(f=0,y=0,p&&p()):this.stop(!0))},a.stop=function(t){f=0,y=0,h=null,d=null,c=null,_=!0,A=0,g&&(g.isValid=!1,g=null),this._stopSilence();var i=p;p=null,S&&S.stop(),t===n&&(t=!1),t&&null!==i&&i()},a.getLength=function(t){return l&&l.spritemap[t]!==n?l.spritemap[t].end-l.spritemap[t].start:0},a.mute=function(){m||(m=!0,S&&c&&(S.pause(),_||this._playSilence()))},a.unmute=function(){m&&(m=!1,S&&c&&(this._stopSilence(),_||this._playAudio()))},a.getMuted=function(){return m},a.isLooping=function(t){return O(t)?l.spritemap[t].loop:void 0},a.hasAlias=function(t){return l?!!l.spritemap[t]:!1},a.getAliases=function(t){var i,n=[];if(t)for(i in l.spritemap)n.push(i);else for(i in l.spritemap)"silence"!=i&&n.push(i);return n},a.destroy=function(){r||(this.stop(),S&&(s.instance.removeUpdateCallback(C),S.destroy()),b=S=l=c=d=h=p=null,r=!0)};var v=function(){this.isValid=!0,this._start=0,this._end=0,this.length=0};Object.defineProperty(v.prototype,"position",{get:function(){return this.isValid&&S?m?1e3*y:1e3*S.getPosition():0}}),v.prototype.stop=function(){this.isValid&&b.stop()},v.prototype.pause=function(){this.isValid&&b.pause()},v.prototype.unpause=function(){this.isValid&&b.resume()},namespace("cloudkid").Audio=u}(window,document),function(){var t=function(t){this._audioListener=this._onAudioFinished.bind(this),this._update=this._update.bind(this),this._updateCaptionPos=this._updateCaptionPos.bind(this),t&&(this.captions=new cloudkid.Captions(null,!0)),this._listHelper=[]},i=t.prototype={};i.audioList=null,i._listCounter=0,i._currentAudio=null,i._audioInst=null,i._callback=null,i._audioListener=null,i._timer=0,i.captions=null,i._listHelper=null,Object.defineProperty(i,"playing",{get:function(){return null!==this._currentAudio||this._timer>0}}),i.play=function(t,i){this.stop(),this._listCounter=-1,this._listHelper[0]=t,this.audioList=this._listHelper,this._callback=i,this._onAudioFinished()},i.playList=function(t,i){this.stop(),this._listCounter=-1,this.audioList=t,this._callback=i,this._onAudioFinished()},i._onAudioFinished=function(){if(cloudkid.OS.instance.removeUpdateCallback("VOPlayer"),this.captions&&this._audioInst&&this.captions.seek(this._audioInst.length),this._audioInst=null,this._listCounter++,this._listCounter>=this.audioList.length){this.captions&&this.captions.stop(),this._currentAudio=null;var t=this._callback;this._callback=null,t&&t()}else this._currentAudio=this.audioList[this._listCounter],"string"==typeof this._currentAudio?this._playAudio():"function"==typeof this._currentAudio?(this._currentAudio(),this._onAudioFinished()):(this._timer=this._currentAudio,this._currentAudio=null,cloudkid.OS.instance.addUpdateCallback("VOPlayer",this._update))},i._update=function(t){this.captions&&this.captions.updateTime(t),this._timer-=t,this._timer<=0&&this._onAudioFinished()},i._updateCaptionPos=function(){this._audioInst&&this.captions.seek(this._audioInst.position)},i._playAudio=function(){var t=cloudkid.Audio.instance;!t.hasAlias(this._currentAudio)&&this.captions&&this.captions.hasCaption(this._currentAudio)?(this.captions.run(this._currentAudio),this._timer=this.captions.currentDuration,this._currentAudio=null,cloudkid.OS.instance.addUpdateCallback("VOPlayer",this._update)):(this._audioInst=t.play(this._currentAudio,this._audioListener),this.captions&&(this.captions.run(this._currentAudio),cloudkid.OS.instance.addUpdateCallback("VOPlayer",this._updateCaptionPos)))},i.stop=function(){this._currentAudio&&(cloudkid.Audio.instance.stop(),this._currentAudio=null,this._callback=null),this.captions&&this.captions.stop(),cloudkid.OS.instance.removeUpdateCallback("VOPlayer"),this.audioList=null,this._timer=0},i.destroy=function(){this.stop(),this.audioList=null,this._listHelper=null,this._currentAudio=null,this._audioInst=null,this._callback=null,this._audioListener=null,this.captions&&(this.captions.destroy(),this.captions=null)},namespace("cloudkid").VOPlayer=t}();