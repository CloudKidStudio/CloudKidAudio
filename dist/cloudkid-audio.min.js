!function(t,i,n){"use strict";var s=cloudkid.OS,e=cloudkid.SwishSprite,o=cloudkid.MediaLoader,a=function(t,i){this._onUpdate=this._onUpdate.bind(this),this._onComplete=this._onComplete.bind(this),this.initialize(t,i)},u=a.prototype,l=null,r=!1,c=null,p=null,d=null,h=null,_=!1,f=0,y=!1,m=0,A=0,k="AudioMute",C="SwishSprite",b=null,v=null,g=null;u.soundLoaded=!1,a.VERSION="2.2.2",a.init=function(t,i){return v||new a(t,i),v},Object.defineProperty(a,"instance",{get:function(){return v}}),u.initialize=function(t,i){v||(r=!1,v=this,"object"==typeof t?S(t,i):"string"==typeof t?o.instance.load(t,function(t){return t&&t.content?void S(t.content,i):void i(!1)}):i(!1))};var S=function(t,i){l=t;var s=!0;l&&l.resources===n&&(s=!1),l&&l.spritemap===n&&(s=!1),i&&i(s)},L=function(t){if(!b)return!1;if(t!==n){if(!l||!l.spritemap)return!1;if(l.spritemap[t]===n)return!1}return!0};u.getAudioSprite=function(){return b},u.load=function(t){if(l){var i,a,u=o.instance.cacheManager,r=l.resources.length;for(i=0;r>i;i++)a=l.resources[i],l.resources[i]=u.prepare(a.url!==n?a.url:a,!0);b||(b=new e(l),b.manualUpdate=!0);var c=this;b.off(e.LOADED),b.on(e.LOADED,function(){b.off(e.LOADED).on(e.PROGRESS,c._onUpdate).on(e.COMPLETE,c._onComplete),c.soundLoaded=!0,t()}),s.instance.addUpdateCallback(C,b.update),b.load()}},u.prepare=function(t){L(t)&&b.prepare(t)},u.isPlaying=function(){return!_},u.pause=function(){!_&&b&&c&&(y?this._stopSilence():b.pause(),_=!0)},u.resume=function(){_&&b&&c&&(y?this._startSilence():b.resume(),_=!1)},u.play=function(t,i,s,e){if(!L(t))return null;var o=c;o&&o.priority===n&&(o.priority=0);var a=l.spritemap[t];return a.priority===n&&(a.priority=0),o&&a.priority<o.priority?(i&&i(),null):(_||this.stop(),p=t,c=a,d=i||null,h=e||null,_=!1,f=0,A=0,y?this._playSilence():this._playAudio(),g=new P,g._end=1e3*c.end,g._start=1e3*c.start,g.length=g._end-g._start,"function"==typeof s&&setTimeout(s,0),g)},u._playSilence=function(){m=this.getLength(p),A=b.getPosition(),h&&h(f),this._startSilence()},u._startSilence=function(){s.instance.addUpdateCallback(k,this._updateSilence.bind(this))},u._stopSilence=function(){s.instance.removeUpdateCallback(k)},u._updateSilence=function(t){A+=t/1e3,f=A/m,m>A?h&&h(Math.min(1,Math.max(0,f))):this._onComplete()},u._playAudio=function(){h&&h(f);var t;A>0&&(t=b.getSound(p).start+A),b.play(p,t)},u._onUpdate=function(t){f=t,h&&h(f)},u._onComplete=function(){c&&(c.loop?(f=0,A=0,d&&d()):this.stop(!0))},u.stop=function(t){f=0,A=0,h=null,p=null,c=null,_=!0,m=0,g&&(g.isValid=!1,g=null),this._stopSilence();var i=d;d=null,b&&b.stop(),t===n&&(t=!1),t&&null!==i&&i()},u.getLength=function(t){return l&&l.spritemap[t]!==n?l.spritemap[t].end-l.spritemap[t].start:0},u.mute=function(){y||(y=!0,b&&c&&(b.pause(),_||this._playSilence()))},u.unmute=function(){y&&(y=!1,b&&c&&(this._stopSilence(),_||this._playAudio()))},u.getMuted=function(){return y},u.isLooping=function(t){return L(t)?l.spritemap[t].loop:void 0},u.hasAlias=function(t){return l?!!l.spritemap[t]:!1},u.getAliases=function(t){var i,n=[];if(t)for(i in l.spritemap)n.push(i);else for(i in l.spritemap)"silence"!=i&&n.push(i);return n},u.destroy=function(){r||(this.stop(),b&&(s.instance.removeUpdateCallback(C),b.destroy()),v=b=l=c=p=h=d=null,r=!0)};var P=function(){this.isValid=!0,this._start=0,this._end=0,this.length=0};Object.defineProperty(P.prototype,"position",{get:function(){return this.isValid&&b?y?1e3*A:1e3*b.getPosition():0}}),P.prototype.stop=function(){this.isValid&&v.stop()},P.prototype.pause=function(){this.isValid&&v.pause()},P.prototype.unpause=function(){this.isValid&&v.resume()},namespace("cloudkid").Audio=a}(window,document),function(){"use strict";var t,i,n,s=function(s){t=cloudkid.Captions,i=cloudkid.Audio,n=cloudkid.OS,this._audioListener=this._onAudioFinished.bind(this),this._update=this._update.bind(this),this._updateCaptionPos=this._updateCaptionPos.bind(this),s&&(this.captions=s instanceof t?s:new t,this.captions.isSlave=!0),this._listHelper=[]},e=s.prototype={},o="VOPlayer";e.audioList=null,e._listCounter=0,e._currentAudio=null,e._audioInst=null,e._callback=null,e._cancelledCallback=null,e._audioListener=null,e._timer=0,e.captions=null,e._listHelper=null,Object.defineProperty(e,"playing",{get:function(){return null!==this._currentAudio||this._timer>0}}),e.play=function(t,i,n){this.stop(),this._listCounter=-1,this._listHelper[0]=t,this.audioList=this._listHelper,this._callback=i,this._cancelledCallback=n,this._onAudioFinished()},e.playList=function(t,i,n){this.stop(),this._listCounter=-1,this.audioList=t,this._callback=i,this._cancelledCallback=n,this._onAudioFinished()},e._onAudioFinished=function(){if(n.instance.removeUpdateCallback(o),this.captions&&this._audioInst&&this.captions.seek(this._audioInst.length),this._audioInst=null,this._listCounter++,this._listCounter>=this.audioList.length){this.captions&&this.captions.stop(),this._currentAudio=null,this._cancelledCallback=null;var t=this._callback;this._callback=null,t&&t()}else this._currentAudio=this.audioList[this._listCounter],"string"==typeof this._currentAudio?this._playAudio():"function"==typeof this._currentAudio?(this._currentAudio(),this._onAudioFinished()):(this._timer=this._currentAudio,this._currentAudio=null,n.instance.addUpdateCallback(o,this._update))},e._update=function(t){this.captions&&this.captions.updateTime(t),this._timer-=t,this._timer<=0&&this._onAudioFinished()},e._updateCaptionPos=function(){return this._audioInst?this._audioInst.isValid?void this.captions.seek(this._audioInst.position):void this.stop():void 0},e._playAudio=function(){var t=i.instance;!t.hasAlias(this._currentAudio)&&this.captions&&this.captions.hasCaption(this._currentAudio)?(this.captions.play(this._currentAudio),this._timer=this.captions.currentDuration,this._currentAudio=null,n.instance.addUpdateCallback(o,this._update)):(this._audioInst=t.play(this._currentAudio,this._audioListener),this.captions&&(this.captions.play(this._currentAudio),n.instance.addUpdateCallback(o,this._updateCaptionPos)))},e.stop=function(){this._currentAudio&&this._audioInst.isValid&&(i.instance.stop(),this._currentAudio=null),this.captions&&this.captions.stop(),n.instance.removeUpdateCallback(o),this.audioList=null,this._timer=0,this._callback=null;var t=this._cancelledCallback;this._cancelledCallback=null,t&&t()},e.destroy=function(){this.stop(),this.audioList=null,this._listHelper=null,this._currentAudio=null,this._audioInst=null,this._callback=null,this._cancelledCallback=null,this._audioListener=null,this.captions&&(this.captions.destroy(),this.captions=null)},namespace("cloudkid").VOPlayer=s,namespace("cloudkid").Audio.VOPlayer=s}();