!function(t,i,n){"use strict";var s=cloudkid.OS,e=cloudkid.SwishSprite,o=cloudkid.MediaLoader,u=function(t,i){this._onUpdate=this._onUpdate.bind(this),this._onComplete=this._onComplete.bind(this),this.initialize(t,i)},a=u.prototype,l=null,r=!1,c=null,p=null,d=null,h=null,_=!1,f=0,m=!1,A=0,y=0,C="AudioMute",b="SwishSprite",k=null,g=null,S=null;a.soundLoaded=!1,u.VERSION="2.0.2",u.init=function(t,i){return g||new u(t,i),g},Object.defineProperty(u,"instance",{get:function(){return g}}),a.initialize=function(t,i){g||(r=!1,g=this,"object"==typeof t?L(t,i):"string"==typeof t?o.instance.load(t,function(t){return t&&t.content?void L(t.content,i):void i(!1)}):i(!1))};var L=function(t,i){l=t;var s=!0;l&&l.resources===n&&(s=!1),l&&l.spritemap===n&&(s=!1),i(s)},v=function(t){if(!k)return!1;if(t!==n){if(!l||!l.spritemap)return!1;if(l.spritemap[t]===n)return!1}return!0};a.getAudioSprite=function(){return k},a.load=function(t){if(l){var i,u,a=o.instance.cacheManager,r=l.resources.length;for(i=0;r>i;i++)u=l.resources[i],l.resources[i]=a.prepare(u.url!==n?u.url:u,!0);k||(k=new e(l),k.manualUpdate=!0);var c=this;k.off(e.LOADED),k.on(e.LOADED,function(){k.off(e.LOADED).on(e.PROGRESS,c._onUpdate).on(e.COMPLETE,c._onComplete),c.soundLoaded=!0,t()}),s.instance.addUpdateCallback(b,k.update),k.load()}},a.prepare=function(t){v(t)&&k.prepare(t)},a.isPlaying=function(){return!_},a.pause=function(){!_&&k&&c&&(m?this._stopSilence():k.pause(),_=!0)},a.resume=function(){_&&k&&c&&(m?this._startSilence():k.resume(),_=!1)},a.play=function(t,i,n,s){return v(t)?(_||this.stop(),p=t,c=l.spritemap[t],d=i||null,h=s||null,_=!1,f=0,y=0,m?this._playSilence():this._playAudio(),S=new P,S._end=1e3*c.end,S._start=1e3*c.start,S.length=S._end-S._start,"function"==typeof n&&setTimeout(n,0),S):null},a._playSilence=function(){A=this.getLength(p),y=k.getPosition(),h&&h(f),this._startSilence()},a._startSilence=function(){s.instance.addUpdateCallback(C,this._updateSilence.bind(this))},a._stopSilence=function(){s.instance.removeUpdateCallback(C)},a._updateSilence=function(t){y+=t/1e3,f=y/A,A>y?h&&h(Math.min(1,Math.max(0,f))):this._onComplete()},a._playAudio=function(){h&&h(f);var t;y>0&&(t=k.getSound(p).start+y),k.play(p,t)},a._onUpdate=function(t){f=t,h&&h(f)},a._onComplete=function(){c&&(c.loop?(f=0,y=0,d&&d()):this.stop(!0))},a.stop=function(t){f=0,y=0,h=null,p=null,c=null,_=!0,A=0,S&&(S.isValid=!1,S=null),this._stopSilence();var i=d;d=null,k&&k.stop(),t===n&&(t=!1),t&&null!==i&&i()},a.getLength=function(t){return l&&l.spritemap[t]!==n?l.spritemap[t].end-l.spritemap[t].start:0},a.mute=function(){m||(m=!0,k&&c&&(k.pause(),_||this._playSilence()))},a.unmute=function(){m&&(m=!1,k&&c&&(this._stopSilence(),_||this._playAudio()))},a.getMuted=function(){return m},a.isLooping=function(t){return v(t)?l.spritemap[t].loop:void 0},a.hasAlias=function(t){return l?!!l.spritemap[t]:!1},a.getAliases=function(t){var i,n=[];if(t)for(i in l.spritemap)n.push(i);else for(i in l.spritemap)"silence"!=i&&n.push(i);return n},a.destroy=function(){r||(this.stop(),k&&(s.instance.removeUpdateCallback(b),k.destroy()),g=k=l=c=p=h=d=null,r=!0)};var P=function(){this.isValid=!0,this._start=0,this._end=0,this.length=0};Object.defineProperty(P.prototype,"position",{get:function(){return this.isValid&&k?m?1e3*y:1e3*k.getPosition():0}}),P.prototype.stop=function(){this.isValid&&g.stop()},P.prototype.pause=function(){this.isValid&&g.pause()},P.prototype.unpause=function(){this.isValid&&g.resume()},namespace("cloudkid").Audio=u}(window,document),function(){var t,i,n,s=function(s){t=cloudkid.Captions,i=cloudkid.Audio,n=cloudkid.OS,this._audioListener=this._onAudioFinished.bind(this),this._update=this._update.bind(this),this._updateCaptionPos=this._updateCaptionPos.bind(this),s&&(this.captions=s instanceof t?s:new t,this.captions.isSlave=!0),this._listHelper=[]},e=s.prototype={},o="VOPlayer";e.audioList=null,e._listCounter=0,e._currentAudio=null,e._audioInst=null,e._callback=null,e._audioListener=null,e._timer=0,e.captions=null,e._listHelper=null,Object.defineProperty(e,"playing",{get:function(){return null!==this._currentAudio||this._timer>0}}),e.play=function(t,i){this.stop(),this._listCounter=-1,this._listHelper[0]=t,this.audioList=this._listHelper,this._callback=i,this._onAudioFinished()},e.playList=function(t,i){this.stop(),this._listCounter=-1,this.audioList=t,this._callback=i,this._onAudioFinished()},e._onAudioFinished=function(){if(n.instance.removeUpdateCallback(o),this.captions&&this._audioInst&&this.captions.seek(this._audioInst.length),this._audioInst=null,this._listCounter++,this._listCounter>=this.audioList.length){this.captions&&this.captions.stop(),this._currentAudio=null;var t=this._callback;this._callback=null,t&&t()}else this._currentAudio=this.audioList[this._listCounter],"string"==typeof this._currentAudio?this._playAudio():"function"==typeof this._currentAudio?(this._currentAudio(),this._onAudioFinished()):(this._timer=this._currentAudio,this._currentAudio=null,n.instance.addUpdateCallback(o,this._update))},e._update=function(t){this.captions&&this.captions.updateTime(t),this._timer-=t,this._timer<=0&&this._onAudioFinished()},e._updateCaptionPos=function(){this._audioInst&&this.captions.seek(this._audioInst.position)},e._playAudio=function(){var t=i.instance;!t.hasAlias(this._currentAudio)&&this.captions&&this.captions.hasCaption(this._currentAudio)?(this.captions.run(this._currentAudio),this._timer=this.captions.currentDuration,this._currentAudio=null,n.instance.addUpdateCallback(o,this._update)):(this._audioInst=t.play(this._currentAudio,this._audioListener),this.captions&&(this.captions.run(this._currentAudio),n.instance.addUpdateCallback(o,this._updateCaptionPos)))},e.stop=function(){this._currentAudio&&(i.instance.stop(),this._currentAudio=null,this._callback=null),this.captions&&this.captions.stop(),n.instance.removeUpdateCallback(o),this.audioList=null,this._timer=0},e.destroy=function(){this.stop(),this.audioList=null,this._listHelper=null,this._currentAudio=null,this._audioInst=null,this._callback=null,this._audioListener=null,this.captions&&(this.captions.destroy(),this.captions=null)},namespace("cloudkid").VOPlayer=s}();